<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="img/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="img/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="img/android-chrome-512x512.png">
    <link rel="manifest" href="img/site.webmanifest">
    <link rel="shortcut icon" href="img/favicon.ico">
    <meta name="theme-color" content="#0f172a">
    <title>Devices - Smart Home Planner</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/devices.css">
    <link rel="stylesheet" href="css/map.css">
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-brand">
                <a href="index.html" class="header-home-link">
                    <img src="img/logo.png" alt="Smart Home Planner logo" class="header-logo">
                    <h1 class="header-title">Smart Home Planner</h1>
                </a>
                <button class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false" aria-controls="main-nav">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M3 6h18"></path>
                        <path d="M3 12h18"></path>
                        <path d="M3 18h18"></path>
                    </svg>
                </button>
            </div>
            <nav class="site-nav" id="main-nav">
                <a href="index.html">Dashboard</a>
                <a href="devices.html" class="active">Devices</a>
                <a href="settings.html">Settings</a>
            </nav>
        </header>

        <section>
            <div class="section-header section-header-inline devices-header">
                <div class="section-title-group">
                    <h2>Devices</h2>
                    <div class="section-subtitle" id="devices-count">0 devices</div>
                </div>
                <div class="view-toggle" role="group" aria-label="View mode">
                    <button class="view-toggle-btn" type="button" data-view="table" aria-pressed="false">Table</button>
                    <button class="view-toggle-btn" type="button" data-view="grid" aria-pressed="false">Grid</button>
                    <button class="view-toggle-btn" type="button" data-view="diagram" aria-pressed="false">Diagram</button>
                </div>
                <div class="devices-header-actions">
                    <button class="btn btn-secondary devices-bulk-btn" type="button" id="bulk-edit-toggle" aria-pressed="false">Bulk Edit</button>
                    <a href="device-add.html" class="btn btn-primary devices-add-btn">Add Device</a>
                </div>
            </div>
            
            <!-- Device Filters Component -->
            <div class="filters-container is-collapsed">
                <div class="filters-header">
                    <h3>Filters</h3>
                    <div class="filters-actions">
                        <button class="btn btn-secondary btn-sm btn-icon filters-toggle no-tooltip" type="button" id="toggle-advanced-filters" aria-expanded="false" aria-controls="advanced-filters" aria-label="Toggle advanced filters">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M6 9l6 6 6-6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="filters-body">
                    <div class="filters-row filters-advanced is-collapsed" id="advanced-filters">
                        <div class="filters-row filters-primary"></div>
                        <div class="filters-row filters-secondary">
                            <div class="filter-field filter-field-wide">
                                <label for="filter-name">Device name</label>
                                <div class="filter-input-with-clear">
                                    <input type="text" id="filter-name" class="filter-input" placeholder="Search by device name">
                                    <button type="button" id="clear-filter-name" class="filter-clear-btn" aria-label="Clear device name filter" hidden>
                                        <svg viewBox="0 0 16 16" aria-hidden="true">
                                            <path d="M4 4l8 8M12 4l-8 8"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="filter-field">
                                <label for="filter-brand">Brand</label>
                                <select id="filter-brand" class="filter-select">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <div class="filter-field">
                                <label for="filter-type">Type</label>
                                <select id="filter-type" class="filter-select">
                                    <option value="">All</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary btn-sm" type="button" id="clear-filters">Clear Filters</button>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Installation</div>
                            <div class="filters-block-body">
                                <div class="filter-field">
                                    <label for="filter-floor">Floor</label>
                                    <select id="filter-floor" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-area">Installed Area</label>
                                    <select id="filter-area" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-controlled-area">Controlled Area</label>
                                    <select id="filter-controlled-area" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-status">Status</label>
                                    <select id="filter-status" class="filter-select">
                                        <option value="">All</option>
                                        <option value="working">Working</option>
                                        <option value="pending">Pending</option>
                                        <option value="not-working">Not Working</option>
                                        <option value="wishlist">Wishlist</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Connectivity</div>
                            <div class="filters-block-body">
                                <div class="filter-field">
                                    <label for="filter-connectivity">Connectivity</label>
                                    <select id="filter-connectivity" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-network">Network</label>
                                    <select id="filter-network" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-thread-border-router">
                                    <span>Thread Border Router</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-matter-hub">
                                    <span>Matter Hub</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-zigbee-controller">
                                    <span>Zigbee Controller</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-zigbee-repeater">
                                    <span>Zigbee Repeater</span>
                                </label>
                            </div>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Labels</div>
                            <div class="filters-block-body">
                                <div class="filter-field filter-field-wide">
                                    <div class="filter-label-row">
                                        <label for="filter-labels">Labels</label>
                                        <span class="label-picker-count" id="filter-labels-count">0 selected</span>
                                    </div>
                                    <select id="filter-labels" class="visually-hidden" multiple></select>
                                    <div class="label-picker label-picker-compact" id="filter-labels-picker" role="listbox" aria-multiselectable="true"></div>
                                    <div class="label-picker-empty" id="filter-labels-empty" hidden>No labels available yet.</div>
                                </div>
                            </div>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Power</div>
                            <div class="filters-block-body">
                                <div class="filter-field">
                                    <label for="filter-power">Power</label>
                                    <select id="filter-power" class="filter-select">
                                        <option value="">All</option>
                                        <option value="wired">Wired</option>
                                        <option value="battery">Battery</option>
                                        <option value="__none__">-</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-ups-protected">UPS Protected</label>
                                    <select id="filter-ups-protected" class="filter-select">
                                        <option value="">All</option>
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-battery-type">Battery Type</label>
                                    <select id="filter-battery-type" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Integrations</div>
                            <div class="filters-block-body">
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-home-assistant">
                                    <span>Home Assistant</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-google-home">
                                    <span>Google Home</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-alexa">
                                    <span>Alexa</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-apple-home-kit">
                                    <span>Apple Home Kit</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-samsung-smartthings">
                                    <span>Samsung SmartThings</span>
                                </label>
                                <div class="filter-field">
                                    <label for="filter-local-only">Local Only</label>
                                    <select id="filter-local-only" class="filter-select">
                                        <option value="">All</option>
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bulk-edit-card">
                <div class="bulk-edit-header">
                    <div>
                        <h3>Bulk Edit</h3>
                        <p class="bulk-edit-subtitle">Apply one change to multiple devices at once.</p>
                    </div>
                    <div class="bulk-edit-meta">
                        <span id="bulk-edit-count">0 selected</span>
                    </div>
                </div>
                <div class="bulk-edit-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bulk-edit-field">Field</label>
                            <select id="bulk-edit-field">
                                <option value="installed-area">Installed Area</option>
                                <option value="controlled-area">Controlled Area</option>
                                <option value="labels-add">Add Label</option>
                                <option value="labels-remove">Remove Label</option>
                                <option value="type">Type</option>
                                <option value="brand">Brand</option>
                                <option value="status">Status</option>
                                <option value="purchase-date">Purchase Date</option>
                                <option value="warranty-expiration">Warranty Expiration</option>
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="installed-area">
                            <label for="bulk-installed-area">Installed Area</label>
                            <select id="bulk-installed-area">
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="controlled-area">
                            <label for="bulk-controlled-area">Controlled Area</label>
                            <select id="bulk-controlled-area">
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="labels-add labels-remove">
                            <label for="bulk-labels">Label</label>
                            <select id="bulk-labels">
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="type">
                            <label for="bulk-type">Type</label>
                            <select id="bulk-type">
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="brand">
                            <label for="bulk-brand">Brand</label>
                            <select id="bulk-brand">
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="status">
                            <label for="bulk-status">Status</label>
                            <select id="bulk-status">
                                <option value="working">Working</option>
                                <option value="pending">Pending</option>
                                <option value="not-working">Not Working</option>
                                <option value="wishlist">Wishlist</option>
                            </select>
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="purchase-date">
                            <label for="bulk-purchase-date">Purchase Date</label>
                            <input type="date" id="bulk-purchase-date">
                        </div>
                        <div class="form-group bulk-edit-field is-collapsed" data-bulk-field="warranty-expiration">
                            <label for="bulk-warranty-expiration">Warranty Expiration</label>
                            <input type="date" id="bulk-warranty-expiration">
                        </div>
                    </div>
                    <div class="bulk-edit-footer">
                        <button class="btn btn-primary" type="button" id="bulk-apply-btn" disabled>Apply</button>
                    </div>
                </div>
            </div>

            <div class="table-container" id="devices-table-container">
                <table class="devices-table">
                    <thead>
                        <tr>
                            <th class="col-select">
                                <label class="table-select">
                                    <input type="checkbox" id="select-all-page" aria-label="Select all devices on this page">
                                </label>
                            </th>
                            <th class="sortable" data-sort="name">
                                Name <span class="sort-icon"></span>
                            </th>
                            <th class="sortable table-col-ha col-optional-md" data-sort="homeAssistant">
                                HA <span class="sort-icon"></span>
                            </th>
                            <th class="sortable col-area-installed" data-sort="area">
                                Installed Area <span class="sort-icon"></span>
                            </th>
                            <th class="sortable col-area-controlled" data-sort="controlledArea">
                                Controlled Area <span class="sort-icon"></span>
                            </th>
                            <th class="sortable" data-sort="brand">
                                Brand <span class="sort-icon"></span>
                            </th>
                            <th class="sortable" data-sort="model">
                                Model <span class="sort-icon"></span>
                            </th>
                            <th class="sortable" data-sort="type">
                                Type <span class="sort-icon"></span>
                            </th>
                            <th class="sortable" data-sort="status">
                                Status <span class="sort-icon"></span>
                            </th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="devices-table-body">
                        <!-- Devices will be rendered here -->
                    </tbody>
                </table>
            </div>

            <div class="devices-grid" id="devices-grid"></div>

            <div id="diagram-section" class="devices-diagram">
                <div class="map-display-settings is-collapsed" id="map-config">
                    <div class="map-display-header">
                        <h3>Diagram settings</h3>
                        <button class="btn btn-secondary btn-sm btn-icon map-display-toggle" type="button" aria-expanded="false" aria-controls="map-config-body" aria-label="Toggle diagram settings">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M6 9l6 6 6-6"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="map-display-body" id="map-config-body">
                        <div class="settings-group map-settings-row">
                            <label class="checkbox-label connection-toggle">
                                <input type="checkbox" id="show-ethernet-connections" checked>
                                <span class="legend-line ethernet" aria-hidden="true"></span>
                                <span>Ethernet Connection</span>
                            </label>
                            <label class="checkbox-label connection-toggle">
                                <input type="checkbox" id="show-usb-connections" checked>
                                <span class="legend-line usb" aria-hidden="true"></span>
                                <span>USB Connection</span>
                            </label>
                            <label class="checkbox-label connection-toggle">
                                <input type="checkbox" id="show-power-connections" checked>
                                <span class="legend-line power" aria-hidden="true"></span>
                                <span>Power Connection</span>
                            </label>
                        </div>
                        <div class="settings-group connection-toggles">
                            <div class="form-group">
                                <label for="device-area-mode">Device location</label>
                                <select id="device-area-mode">
                                    <option value="installed" selected>Installed area</option>
                                    <option value="controlled">Controlled area</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="power-label-mode">Power connection label</label>
                                <select id="power-label-mode">
                                    <option value="idle">Idle</option>
                                    <option value="mean" selected>Mean</option>
                                    <option value="max">Max</option>
                                </select>
                            </div>
                        </div>
                        <!-- Background image upload disabled for now. -->
                        <!--
                        <div class="settings-group map-background-group">
                            <div class="map-background-header">
                                <span class="map-background-title">Diagram background</span>
                                <span class="map-background-file" id="diagram-background-name">No background image</span>
                            </div>
                            <div class="map-background-actions">
                                <button class="btn btn-secondary btn-sm" type="button" id="diagram-background-upload-btn">Upload image</button>
                                <button class="btn btn-secondary btn-sm" type="button" id="diagram-background-replace-btn" hidden>Replace</button>
                                <button class="btn btn-secondary btn-sm" type="button" id="diagram-background-remove-btn" hidden>Remove</button>
                            </div>
                            <div class="map-background-tuning">
                                <div class="form-group">
                                    <label for="diagram-background-opacity">Background opacity</label>
                                    <div class="map-range-row">
                                        <input type="range" id="diagram-background-opacity" min="0" max="100" step="1" value="55">
                                        <span class="map-range-value" id="diagram-background-opacity-value">55%</span>
                                    </div>
                                </div>
                            </div>
                            <input type="file" id="diagram-background-input" accept="image/*" hidden>
                        </div>
                        -->
                    </div>
                </div>

                <div class="map-stage">
                    <div id="network-map-background" aria-hidden="true"></div>
                    <div id="network-map"></div>
                    <div class="map-controls-overlay">
                        <div class="map-controls">
                            <button class="btn btn-secondary btn-sm" id="toggle-edit-layout-btn">Edit Layout</button>
                            <button class="btn btn-secondary btn-sm" id="fit-network-btn">Fit to Screen</button>
                            <button class="btn btn-secondary btn-sm btn-icon" id="fullscreen-map-btn" aria-pressed="false" aria-label="Full screen" title="Full screen">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M4 9V4h5"></path>
                                    <path d="M20 15v5h-5"></path>
                                    <path d="M20 9V4h-5"></path>
                                    <path d="M4 15v5h5"></path>
                                    <path d="M4 4l6 6"></path>
                                    <path d="M20 4l-6 6"></path>
                                    <path d="M4 20l6-6"></path>
                                    <path d="M20 20l-6-6"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="map-controls map-controls-secondary">
                            <button class="btn btn-secondary btn-sm" id="reset-layout-btn" style="display: none;" disabled>Reset</button>
                            <button class="btn btn-secondary btn-sm" id="cancel-layout-btn" style="display: none;" disabled>Cancel</button>
                            <button class="btn btn-primary btn-sm" id="save-positions-btn" style="display: none;" disabled>Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="pagination-info">Showing 0-0 of 0</span>
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-sm btn-secondary" id="prev-page-btn" disabled>Previous</button>
                    <span id="page-numbers"></span>
                    <button class="btn btn-sm btn-secondary" id="next-page-btn" disabled>Next</button>
                </div>
                <div class="pagination-size">
                    <label for="page-size">Per page:</label>
                    <select id="page-size" class="filter-select">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </section>
    </div>

    <script src="js/metadata.js"></script>
    <script src="js/common.js"></script>
    <script src="js/device-filters.js"></script>
    <script src="js/map-cytoscape.js"></script>
    <script src="js/devices.js"></script>
</body>
</html>
