<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="img/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="img/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="img/android-chrome-512x512.png">
    <link rel="manifest" href="img/site.webmanifest">
    <link rel="shortcut icon" href="img/favicon.ico">
    <meta name="theme-color" content="#0f172a">
    <title>Settings - Smart Home Planner</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/settings.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-brand">
                <a href="index.html" class="header-home-link">
                    <img src="img/logo.png" alt="Smart Home Planner logo" class="header-logo">
                    <h1 class="header-title">Smart Home Planner</h1>
                </a>
                <button class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false" aria-controls="main-nav">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M3 6h18"></path>
                        <path d="M3 12h18"></path>
                        <path d="M3 18h18"></path>
                    </svg>
                </button>
            </div>
            <nav class="site-nav" id="main-nav">
                <a href="index.html">Dashboard</a>
                <a href="devices.html">Devices</a>
                <a href="settings.html" class="active">Settings</a>
            </nav>
        </header>

        <section>
            <div class="section-header">
                <h2>Settings</h2>
            </div>

            <div class="settings-container">
                <div class="settings-layout">
                    <div class="settings-mobile-nav">
                        <button
                            class="settings-mobile-nav-toggle"
                            id="settings-mobile-nav-toggle"
                            type="button"
                            aria-expanded="false"
                            aria-controls="settings-menu-drawer"
                        >
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 6h18"></path>
                                <path d="M3 12h18"></path>
                                <path d="M3 18h18"></path>
                            </svg>
                            <span id="settings-mobile-nav-label">General</span>
                        </button>
                    </div>

                    <aside class="settings-menu" id="settings-menu-drawer" aria-label="Settings sections">
                        <div class="settings-menu-header">
                            <p class="settings-menu-heading">Sections</p>
                            <button class="settings-menu-close" id="settings-menu-close" type="button" aria-label="Close sections menu">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M6 6l12 12"></path>
                                    <path d="M18 6L6 18"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="settings-menu-list" role="tablist" aria-label="Settings sections">
                            <button class="settings-menu-btn is-active" id="settings-tab-general" role="tab" aria-controls="settings-panel-general" type="button" data-settings-panel-target="general" aria-selected="true">
                                <span class="settings-menu-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M4 6h16"></path>
                                        <path d="M4 12h10"></path>
                                        <path d="M4 18h16"></path>
                                    </svg>
                                </span>
                                <span class="settings-menu-label">
                                    <span class="settings-menu-title">General</span>
                                </span>
                                <span class="settings-menu-indicator" aria-hidden="true"></span>
                            </button>
                            <button class="settings-menu-btn" id="settings-tab-device-options" role="tab" aria-controls="settings-panel-device-options" type="button" data-settings-panel-target="device-options" aria-selected="false">
                                <span class="settings-menu-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M4 7h16"></path>
                                        <path d="M7 7v10"></path>
                                        <path d="M17 7v10"></path>
                                        <path d="M4 17h16"></path>
                                    </svg>
                                </span>
                                <span class="settings-menu-label">
                                    <span class="settings-menu-title">Device Options</span>
                                </span>
                                <span class="settings-menu-indicator" aria-hidden="true"></span>
                            </button>
                            <button class="settings-menu-btn" id="settings-tab-ha-integration" role="tab" aria-controls="settings-panel-ha-integration" type="button" data-settings-panel-target="ha-integration" aria-selected="false">
                                <span class="settings-menu-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M3 10l9-7 9 7"></path>
                                        <path d="M6 9.5v10.5h12v-10.5"></path>
                                        <path d="M10 20v-5h4v5"></path>
                                    </svg>
                                </span>
                                <span class="settings-menu-label">
                                    <span class="settings-menu-title">Home Assistant Integration</span>
                                </span>
                                <span class="settings-menu-indicator" aria-hidden="true"></span>
                            </button>
                        </div>
                    </aside>
                    <button class="settings-menu-backdrop" id="settings-menu-backdrop" type="button" aria-hidden="true" tabindex="-1"></button>

                    <div class="settings-panels">
                        <div class="settings-panel is-active" role="tabpanel" aria-labelledby="settings-tab-general" data-settings-panel="general" id="settings-panel-general">
                            <div class="settings-section">
                                <h3 class="settings-section-title">Data Management</h3>
                                <p class="settings-description">Export your full backup as a TAR archive (data.json + files), or import from a TAR backup file.</p>
                                
                                <div class="settings-actions">
                                    <div class="settings-action-group">
                                        <h4>Export Data</h4>
                                        <p>Download a TAR backup containing data.json and every file stored by the app.</p>
                                        <button class="btn btn-primary" id="export-btn">Export Data</button>
                                    </div>

                                    <div class="settings-action-group">
                                        <h4>Import Data</h4>
                                        <p>Import from a TAR backup. This will replace all existing data and uploaded files.</p>
                                        <div class="import-wrapper">
                                            <input type="file" id="import-file" accept=".tar,application/x-tar" style="display: none;">
                                            <button class="btn btn-secondary" id="import-btn">Choose File</button>
                                            <span id="import-file-name" class="import-file-name"></span>
                                        </div>
                                        <button class="btn btn-danger" id="import-confirm-btn" style="display: none; margin-top: 0.5rem;">Import Data</button>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h3 class="settings-section-title">Networks</h3>
                                <p class="settings-description">Create VLANs to organize devices by network.</p>

                                <div class="networks-grid">
                                    <div class="form-group networks-actions">
                                        <button class="btn btn-primary" id="network-add-btn">Add Network</button>
                                    </div>
                                </div>

                                <div class="networks-list" id="networks-list"></div>
                            </div>

                            <div class="settings-section">
                                <h3 class="settings-section-title">Follow Us</h3>
                                <ul class="social-links-list">
                                    <li id="social-github-item">
                                        <a class="social-link-btn" id="social-github-link" href="#" aria-label="View on GitHub" title="View on GitHub" target="_blank" rel="noopener noreferrer">
                                            <svg class="social-link-icon" aria-hidden="true" viewBox="0 0 24 24">
                                                <path d="M12 .5a12 12 0 0 0-3.79 23.39c.6.11.82-.26.82-.58v-2.03c-3.34.73-4.04-1.41-4.04-1.41-.55-1.38-1.33-1.75-1.33-1.75-1.09-.75.08-.74.08-.74 1.2.08 1.83 1.23 1.83 1.23 1.07 1.84 2.82 1.31 3.5 1 .11-.77.42-1.31.76-1.61-2.67-.31-5.47-1.33-5.47-5.94 0-1.31.47-2.38 1.23-3.22-.12-.3-.53-1.56.12-3.25 0 0 1.01-.32 3.3 1.23a11.32 11.32 0 0 1 6 0c2.29-1.55 3.3-1.23 3.3-1.23.65 1.69.24 2.95.12 3.25.76.84 1.23 1.91 1.23 3.22 0 4.62-2.81 5.63-5.49 5.93.43.37.81 1.1.81 2.21v3.27c0 .32.22.7.83.58A12 12 0 0 0 12 .5Z"></path>
                                            </svg>
                                            <span>GitHub</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="social-link-btn" href="https://x.com/shcompared" aria-label="Follow us on X" title="Follow us on X" target="_blank" rel="noopener noreferrer">
                                            <svg class="social-link-icon" aria-hidden="true" viewBox="0 0 24 24">
                                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                                            </svg>
                                            <span>X</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="social-link-btn" href="https://youtube.com/@SmartHomeCompared" aria-label="Follow us on YouTube" title="Follow us on YouTube" target="_blank" rel="noopener noreferrer">
                                            <svg class="social-link-icon" aria-hidden="true" viewBox="0 0 32 32">
                                                <path d="M31.7,9.6c0,0-0.3-2.2-1.3-3.2c-1.2-1.3-2.6-1.3-3.2-1.4C22.7,4.7,16,4.7,16,4.7h0c0,0-6.7,0-11.2,0.3 c-0.6,0.1-2,0.1-3.2,1.4c-1,1-1.3,3.2-1.3,3.2S0,12.2,0,14.8v2.4c0,2.6,0.3,5.2,0.3,5.2s0.3,2.2,1.3,3.2c1.2,1.3,2.8,1.2,3.5,1.4 C7.7,27.2,16,27.3,16,27.3s6.7,0,11.2-0.3c0.6-0.1,2-0.1,3.2-1.4c1-1,1.3-3.2,1.3-3.2s0.3-2.6,0.3-5.2v-2.4 C32,12.2,31.7,9.6,31.7,9.6z M12.7,20.2l0-9l8.6,4.5L12.7,20.2z"></path>
                                            </svg>
                                            <span>YouTube</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="social-link-btn" href="https://instagram.com/smarthomecompared" aria-label="Follow us on Instagram" title="Follow us on Instagram" target="_blank" rel="noopener noreferrer">
                                            <svg class="social-link-icon" aria-hidden="true" viewBox="0 0 32 32">
                                                <path d="M16,3.7c4,0,4.479.015,6.061.087a6.426,6.426,0,0,1,4.51,1.639,6.426,6.426,0,0,1,1.639,4.51C28.282,11.521,28.3,12,28.3,16s-.015,4.479-.087,6.061a6.426,6.426,0,0,1-1.639,4.51,6.425,6.425,0,0,1-4.51,1.639c-1.582.072-2.056.087-6.061.087s-4.479-.015-6.061-.087a6.426,6.426,0,0,1-4.51-1.639,6.425,6.425,0,0,1-1.639-4.51C3.718,20.479,3.7,20.005,3.7,16s.015-4.479.087-6.061a6.426,6.426,0,0,1,1.639-4.51A6.426,6.426,0,0,1,9.939,3.79C11.521,3.718,12,3.7,16,3.7M16,1c-4.073,0-4.584.017-6.185.09a8.974,8.974,0,0,0-6.3,2.427,8.971,8.971,0,0,0-2.427,6.3C1.017,11.416,1,11.927,1,16s.017,4.584.09,6.185a8.974,8.974,0,0,0,2.427,6.3,8.971,8.971,0,0,0,6.3,2.427c1.6.073,2.112.09,6.185.09s4.584-.017,6.185-.09a8.974,8.974,0,0,0,6.3-2.427,8.971,8.971,0,0,0,2.427-6.3c.073-1.6.09-2.112.09-6.185s-.017-4.584-.09-6.185a8.974,8.974,0,0,0-2.427-6.3,8.971,8.971,0,0,0-6.3-2.427C20.584,1.017,20.073,1,16,1Z"></path>
                                                <path d="M16,8.3A7.7,7.7,0,1,0,23.7,16,7.7,7.7,0,0,0,16,8.3ZM16,21a5,5,0,1,1,5-5A5,5,0,0,1,16,21Z"></path>
                                                <circle cx="24.007" cy="7.993" r="1.8"></circle>
                                            </svg>
                                            <span>Instagram</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="social-link-btn" href="https://www.reddit.com/user/smarthomecompared" aria-label="Follow us on Reddit" title="Follow us on Reddit" target="_blank" rel="noopener noreferrer">
                                            <svg class="social-link-icon" aria-hidden="true" viewBox="0 0 90 90">
                                                <path d="M89.998 45.604c-.201-5.442-4.77-9.691-10.229-9.506-2.419.084-4.719 1.075-6.466 2.737-7.693-5.24-16.729-8.113-26.017-8.314L51.67 9.442l14.461 3.041c.402 3.712 3.728 6.4 7.44 5.996 3.712-.402 6.4-3.728 5.996-7.44-.404-3.712-3.728-6.4-7.44-5.996-2.134.218-4.048 1.461-5.105 3.309L50.461 5.043c-1.125-.252-2.251.453-2.503 1.596 0 0 0 .017 0 .033L42.97 30.119c-9.406.152-18.559 3.041-26.352 8.314-3.964-3.728-10.212-3.544-13.94.437-3.728 3.964-3.544 10.212.437 13.94.773.722 1.662 1.344 2.653 1.781-.068.991-.068 1.982 0 2.973 0 15.133 17.636 27.444 39.386 27.444 21.75 0 39.386-12.295 39.386-27.444.068-.991.068-1.982 0-2.973 3.392-1.697 5.526-5.191 5.458-8.987zM22.429 52.373c0-3.728 3.041-6.769 6.769-6.769s6.769 3.041 6.769 6.769c0 3.728-3.041 6.769-6.769 6.769-3.745-.034-6.769-3.04-6.769-6.769zm39.252 18.845v-.269c-4.804 3.611-10.682 5.458-16.696 5.207-6.014.252-11.891-1.596-16.696-5.207-.638-.773-.521-1.931.252-2.569.671-.554 1.629-.554 2.318 0 4.065 2.973 9.02 4.485 14.058 4.249 5.039.269 10.011-1.176 14.125-4.114.739-.722 1.948-.706 2.671.033.723.739.706 1.948-.032 2.67zm-.924-11.589c-.117 0-.218 0-.336 0l.051-.252c-3.728 0-6.769-3.041-6.769-6.769 0-3.728 3.041-6.769 6.769-6.769 3.728 0 6.769 3.041 6.769 6.769.15 3.729-2.755 6.869-6.484 7.021z"></path>
                                            </svg>
                                            <span>Reddit</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="social-link-btn" href="https://stacker.news/shcompared" aria-label="Follow us on Stacker News" title="Follow us on Stacker News" target="_blank" rel="noopener noreferrer">
                                            <svg class="social-link-icon" aria-hidden="true" viewBox="0 0 200 307">
                                                <path d="M56 0L107.606 131H90.2129H89L1.52588e-05 131L177 307L106.979 165H121H160H200L56 0Z"></path>
                                            </svg>
                                            <span>Stacker News</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-device-options" data-settings-panel="device-options" id="settings-panel-device-options" hidden>
                            <div class="settings-section">
                                <h3 class="settings-section-title">Device Options</h3>
                                <p class="settings-description">Manage the available options for brands, types, connectivity, and battery types used in device forms.</p>
                                <div id="options-management">
                                    <!-- Options will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <div class="settings-panel" role="tabpanel" aria-labelledby="settings-tab-ha-integration" data-settings-panel="ha-integration" id="settings-panel-ha-integration" hidden>
                            <div class="settings-section">
                                <h3 class="settings-section-title">Areas</h3>
                                <div class="settings-actions">
                                    <div class="settings-action-group">
                                        <h4>Areas</h4>
                                        <p>The device area from Home Assistant will be mapped to the option selected below.</p>
                                        <div class="ha-area-mapping-options" role="radiogroup" aria-label="Home Assistant area mapping target">
                                            <label class="ha-area-mapping-option" for="ha-area-sync-target-installed">
                                                <input type="radio" id="ha-area-sync-target-installed" name="ha-area-sync-target" value="installed">
                                                <span class="ha-area-mapping-content">
                                                    <span class="ha-area-mapping-title">Installed Area</span>
                                                    <span class="ha-area-mapping-description">Installed area is where the device is physically located.</span>
                                                </span>
                                            </label>
                                            <label class="ha-area-mapping-option" for="ha-area-sync-target-controlled">
                                                <input type="radio" id="ha-area-sync-target-controlled" name="ha-area-sync-target" value="controlled">
                                                <span class="ha-area-mapping-content">
                                                    <span class="ha-area-mapping-title">Controlled Area</span>
                                                    <span class="ha-area-mapping-description">Controlled area is the space this device controls, even if it is installed elsewhere.</span>
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <h3 class="settings-section-title">Excluded Devices</h3>
                                <p class="settings-description">Devices removed from the app while still existing in Home Assistant. Restore them to add them back to the app.</p>
                                <div class="table-container excluded-table-container" id="excluded-devices-table-container">
                                    <table class="excluded-devices-table" id="excluded-devices-table">
                                        <thead>
                                            <tr>
                                                <th class="sortable" data-sort="name">
                                                    Name <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="manufacturer">
                                                    Manufacturer <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="model">
                                                    Model <span class="sort-icon"></span>
                                                </th>
                                                <th>
                                                    Actions
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="excluded-devices-table-body">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="excluded-devices-empty" id="excluded-devices-empty">No excluded devices.</div>
                                <div class="pagination-container excluded-pagination" id="excluded-devices-pagination">
                                    <div class="pagination-info">
                                        <span id="excluded-pagination-info">Showing 0-0 of 0</span>
                                    </div>
                                    <div class="pagination-controls">
                                        <button class="btn btn-sm btn-secondary" id="excluded-prev-page-btn" disabled>Previous</button>
                                        <span id="excluded-page-numbers"></span>
                                        <button class="btn btn-sm btn-secondary" id="excluded-next-page-btn" disabled>Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="modal is-hidden" id="network-modal" aria-hidden="true">
        <div class="modal-overlay" id="network-modal-overlay"></div>
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="network-modal-title">
            <div class="modal-header">
                <div class="modal-title" id="network-modal-title">Add Network</div>
            </div>
            <div class="form-group">
                <label for="network-modal-input">Network Name</label>
                <input type="text" id="network-modal-input" placeholder="e.g., vlan10">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" type="button" id="network-modal-cancel">Cancel</button>
                <button class="btn btn-primary" type="button" id="network-modal-save">Save</button>
            </div>
        </div>
    </div>

    <div class="modal is-hidden" id="option-add-modal" aria-hidden="true">
        <div class="modal-overlay" id="option-add-modal-overlay"></div>
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="option-add-modal-title">
            <div class="modal-header">
                <div class="modal-title" id="option-add-modal-title">Add Option</div>
            </div>
            <div class="form-group">
                <label for="option-add-modal-input" id="option-add-modal-label">Value</label>
                <input type="text" id="option-add-modal-input" maxlength="80" placeholder="Enter a value">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" type="button" id="option-add-modal-cancel">Cancel</button>
                <button class="btn btn-primary" type="button" id="option-add-modal-save">Add</button>
            </div>
        </div>
    </div>

    <script src="js/metadata.js"></script>
    <script src="js/common.js"></script>
    <script src="js/settings.js"></script>
</body>
</html>
