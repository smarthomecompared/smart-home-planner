<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="img/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="img/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="img/android-chrome-512x512.png">
    <link rel="manifest" href="img/site.webmanifest">
    <link rel="shortcut icon" href="img/favicon.ico">
    <meta name="theme-color" content="#0f172a">
    <title>Map - Smart Home Planner</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/map.css">
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-brand">
                <a href="index.html" class="header-home-link">
                    <img src="img/logo.png" alt="Smart Home Planner logo" class="header-logo">
                    <h1 class="header-title">Smart Home Planner</h1>
                </a>
                <button class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false" aria-controls="main-nav">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M3 6h18"></path>
                        <path d="M3 12h18"></path>
                        <path d="M3 18h18"></path>
                    </svg>
                </button>
            </div>
            <nav class="site-nav" id="main-nav">
                <a href="index.html">Dashboard</a>
                <a href="devices.html">Devices</a>
                <a href="areas.html">Areas</a>
                <a href="floors.html">Floors</a>
                <a href="settings.html">Settings</a>
            </nav>
        </header>

        <section id="map-section">
            <div class="section-header section-header-inline section-header-map">
                <div class="section-title-group">
                    <h2>Map</h2>
                    <div class="section-subtitle" id="map-devices-count">0 devices</div>
                </div>
                <a href="device-add.html" class="btn btn-primary">Add Device</a>
            </div>

            <!-- Device Filters Component -->
            <div class="filters-container">
                <div class="filters-header">
                    <h3>Filters</h3>
                    <div class="filters-actions">
                        <button class="btn btn-secondary btn-sm btn-icon filters-toggle" type="button" id="toggle-advanced-filters" aria-expanded="false" aria-controls="advanced-filters" aria-label="Toggle advanced filters">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M6 9l6 6 6-6"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="filters-body">
                    <div class="filters-row filters-primary">
                        <div class="filter-field filter-field-wide">
                            <label for="filter-name">Device name</label>
                            <input type="text" id="filter-name" class="filter-input" placeholder="Search by device name">
                        </div>
                        <button class="btn btn-secondary btn-sm" type="button" id="clear-filters">Clear Filters</button>
                    </div>
                    <div class="filters-row filters-secondary">
                        <div class="filter-field">
                            <label for="filter-floor">Floor</label>
                            <select id="filter-floor" class="filter-select">
                                <option value="">All</option>
                            </select>
                        </div>
                        <div class="filter-field">
                            <label for="filter-area">Area</label>
                            <select id="filter-area" class="filter-select">
                                <option value="">All</option>
                            </select>
                        </div>
                        <div class="filter-field">
                            <label for="filter-brand">Brand</label>
                            <select id="filter-brand" class="filter-select">
                                <option value="">All</option>
                            </select>
                        </div>
                        <div class="filter-field">
                            <label for="filter-status">Status</label>
                            <select id="filter-status" class="filter-select">
                                <option value="">All</option>
                                <option value="working">Working</option>
                                <option value="pending">Pending</option>
                                <option value="not-working">Not Working</option>
                            </select>
                        </div>
                        <div class="filter-field">
                            <label for="filter-type">Type</label>
                            <select id="filter-type" class="filter-select">
                                <option value="">All</option>
                            </select>
                        </div>
                    </div>
                    <div class="filters-row filters-advanced is-collapsed" id="advanced-filters">
                        <div class="filters-block">
                            <div class="filters-block-title">Connectivity</div>
                            <div class="filters-block-body">
                                <div class="filter-field">
                                    <label for="filter-connectivity">Connectivity</label>
                                    <select id="filter-connectivity" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-thread-border-router">
                                    <span>Thread Border Router</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-matter-hub">
                                    <span>Matter Hub</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-zigbee-controller">
                                    <span>Zigbee Controller</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-zigbee-repeater">
                                    <span>Zigbee Repeater</span>
                                </label>
                            </div>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Power</div>
                            <div class="filters-block-body">
                                <div class="filter-field">
                                    <label for="filter-power">Power</label>
                                    <select id="filter-power" class="filter-select">
                                        <option value="">All</option>
                                        <option value="wired">Wired</option>
                                        <option value="battery">Battery</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-ups-protected">UPS Protected</label>
                                    <select id="filter-ups-protected" class="filter-select">
                                        <option value="">All</option>
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                                <div class="filter-field">
                                    <label for="filter-battery-type">Battery Type</label>
                                    <select id="filter-battery-type" class="filter-select">
                                        <option value="">All</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="filters-block">
                            <div class="filters-block-title">Integrations</div>
                            <div class="filters-block-body">
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-home-assistant">
                                    <span>Home Assistant</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-google-home">
                                    <span>Google Home</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-alexa">
                                    <span>Alexa</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-apple-home-kit">
                                    <span>Apple Home Kit</span>
                                </label>
                                <label class="checkbox-chip">
                                    <input type="checkbox" id="filter-samsung-smartthings">
                                    <span>Samsung SmartThings</span>
                                </label>
                            </div>
                        </div>
                        <div class="filters-block is-connectivity-options">
                            <div class="filters-block-title">Connectivity Options</div>
                            <div class="filters-block-body">
                                <div class="filter-field">
                                    <label for="filter-local-only">Local Only</label>
                                    <select id="filter-local-only" class="filter-select">
                                        <option value="">All</option>
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map Display Settings -->
            <div class="map-display-settings is-collapsed" id="map-config">
                <div class="map-display-header">
                    <h3>Configuration</h3>
                    <button class="btn btn-secondary btn-sm btn-icon map-display-toggle" type="button" aria-expanded="false" aria-controls="map-config-body" aria-label="Toggle configuration">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M6 9l6 6 6-6"></path>
                        </svg>
                    </button>
                </div>
                <div class="map-display-body" id="map-config-body">
                    <div class="settings-group connection-toggles">
                        <label class="checkbox-label connection-toggle">
                            <input type="checkbox" id="show-ethernet-connections" checked>
                            <span class="legend-line ethernet" aria-hidden="true"></span>
                            <span>Ethernet Connection</span>
                        </label>
                        <label class="checkbox-label connection-toggle">
                            <input type="checkbox" id="show-usb-connections" checked>
                            <span class="legend-line usb" aria-hidden="true"></span>
                            <span>USB Connection</span>
                        </label>
                        <label class="checkbox-label connection-toggle">
                            <input type="checkbox" id="show-power-connections" checked>
                            <span class="legend-line power" aria-hidden="true"></span>
                            <span>Power Connection</span>
                        </label>
                    </div>
                    <div class="settings-group connection-toggles">
                        <div class="form-group">
                            <label for="power-label-mode">Power connection label</label>
                            <select id="power-label-mode">
                                <option value="idle">Idle</option>
                                <option value="mean" selected>Mean</option>
                                <option value="max">Max</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="map-stage">
                <div id="network-map"></div>
                <div class="map-controls-overlay">
                    <div class="map-controls">
                        <button class="btn btn-secondary btn-sm" id="toggle-edit-layout-btn">Edit Layout</button>
                        <button class="btn btn-secondary btn-sm" id="fit-network-btn">Fit to Screen</button>
                        <button class="btn btn-secondary btn-sm btn-icon" id="fullscreen-map-btn" aria-pressed="false" aria-label="Full screen" title="Full screen">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M4 9V4h5"></path>
                                <path d="M20 15v5h-5"></path>
                                <path d="M20 9V4h-5"></path>
                                <path d="M4 15v5h5"></path>
                                <path d="M4 4l6 6"></path>
                                <path d="M20 4l-6 6"></path>
                                <path d="M4 20l6-6"></path>
                                <path d="M20 20l-6-6"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="map-controls map-controls-secondary">
                        <button class="btn btn-secondary btn-sm" id="reset-layout-btn" style="display: none;" disabled>Reset</button>
                        <button class="btn btn-secondary btn-sm" id="cancel-layout-btn" style="display: none;" disabled>Cancel</button>
                        <button class="btn btn-primary btn-sm" id="save-positions-btn" style="display: none;" disabled>Save</button>
                    </div>
                </div>
            </div>

        </section>
    </div>

    <script src="js/metadata.js"></script>
    <script src="js/common.js"></script>
    <script src="js/device-filters.js"></script>
    <script src="js/map-cytoscape.js"></script>
    <script>
        if (window.DeviceDiagram) {
            window.DeviceDiagram.initWithStoredData({ enableFilters: true });
        }
    </script>
</body>
</html>
